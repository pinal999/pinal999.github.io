<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Telegram Web App Demo</title>
    <script src="https://telegram.org/js/telegram-web-app.js?1"></script>
    <script>
        function setThemeClass() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        }

        Telegram.WebApp.onEvent('themeChanged', setThemeClass);
        setThemeClass();

        const DemoApp = {
            sendText(spam = false) {
                const textField = document.querySelector('#text_field');
                const text = textField.textContent.trim();
                if (!text) return textField.focus();

                if (new Blob([text]).size > 4096) {
                    return alert('Text is too long');
                }

                const repeat = spam ? 10 : 1;
                for (let i = 0; i < repeat; i++) {
                    Telegram.WebApp.sendData(text);
                }
            },

            sendTime(spam = false) {
                const repeat = spam ? 10 : 1;
                for (let i = 0; i < repeat; i++) {
                    Telegram.WebApp.sendData(new Date().toString());
                }
            },

            sendMessage(msg_id = '', with_webview = false) {
                if (Telegram.WebApp.initDataUnsafe.query_id) {
                    return alert('WebViewQueryId not defined');
                }

                const btnStatus = document.querySelector('#btn_status');
                btnStatus.textContent = 'Sending...';

                // Dummy response to simulate API request
                setTimeout(() => {
                    btnStatus.textContent = 'Message sent successfully!';
                    btnStatus.style.display = 'block';
                }, 1000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            document.body.style.visibility = '';
            Telegram.WebApp.ready();
        });
    </script>
</head>
<body style="visibility: hidden;">
<section>
    <button id="send_text_btn" onclick="DemoApp.sendText();">Send Text</button>
    <button id="send_time_btn" onclick="DemoApp.sendTime();">Send Time</button>
    <button id="send_message_btn" onclick="DemoApp.sendMessage();">Send Message</button>
    <div id="btn_status" style="display:none;"></div>
    <div contenteditable="true" id="text_field" placeholder="Input text here..."></div>
</section>
</body>
</html>
